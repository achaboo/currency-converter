# CLAUDE.md — AIエージェント行動指針

## ワークフロー管理

### 1. 計画優先の原則
- 3ステップ以上、または設計上の判断が必要なタスクは、必ず**計画モード**から始める
- 作業が行き詰まったら、すぐに**立ち止まって再計画**する。そのまま進めない
- 作業中だけでなく、検証ステップでも計画モードを活用する
- 曖昧さを減らすため、仕様は最初に詳しく書き出す

### 2. サブエージェント活用戦略
- メインのコンテキストウィンドウをクリーンに保つため、サブエージェントを積極的に活用する
- 調査・探索・並列分析はサブエージェントに任せる
- 複雑な問題には、サブエージェントを増やして対処する
- 1つのサブエージェントに1つのタスクを割り当て、集中して実行する

### 3. 自己改善ループ
- ユーザーから修正を受けたら、**必ず** `tasks/lessons.md` にそのパターンを記録する
- 同じミスを防ぐためのルールを自分自身のために書き残す
- ミスの発生率が下がるまで、教訓を繰り返し見直して改善する
- セッション開始時に、関連プロジェクトの教訓を確認する

### 4. 完了前の検証
- 動作確認が取れるまで、タスクを「完了」とマークしない
- 必要に応じて、変更前後の差分を確認する
- 「シニアエンジニアはこれを承認するか？」と自問する
- テストを実行し、ログを確認し、正しく動くことを示す

### 5. エレガントな解決策を追求する（バランス重視）
- 重要な変更を行う前に立ち止まり、「もっとスマートな方法はないか？」と考える
- その場しのぎの修正に感じたら、「今知っていることをすべて踏まえた、より良い解決策」を実装する
- 単純・明快な修正にはこの原則を適用しない。過剰設計は避ける
- 自分の作業を提示する前に、自分自身でチェックする

### 6. 自律的なバグ修正
- バグ報告を受けたら、細かい確認を求めず**自分で解決**する
- ログ・エラー・失敗テストを手がかりに、自ら解消する
- ユーザーにコンテキストの切り替えを求めない
- CIテストが失敗している場合、指示されなくても修正しに行く

---

## タスク管理の手順

1. **計画を立てる**: チェック可能な項目として `tasks/todo.md` に計画を書き出す
2. **計画を確認する**: 実装を始める前に計画を見直す
3. **進捗を記録する**: 作業しながら完了した項目をマークしていく
4. **変更を説明する**: 各ステップで変更内容の概要をわかりやすく伝える
5. **結果を記録する**: `tasks/todo.md` にレビューセクションを追加する
6. **教訓を残す**: 修正があったら `tasks/lessons.md` を更新する

---

## 基本方針

- **シンプルさ優先**: 変更はできる限りシンプルに。影響範囲を最小限に抑える
- **その場しのぎ禁止**: 根本原因を探る。一時的な対処はしない。シニア開発者の基準を守る
- **最小限の変更**: 必要な箇所だけ触る。新たなバグを持ち込まない
